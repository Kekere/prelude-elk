<!DOCTYPE html>
<meta charset="utf-8">
<head>
</head>
<body>

  <div class="topnav">
    <a id="home" href="#home">Load </a>
    <a class="active" href="#graph" id="generate-graph">Generate Graph</a>
    <!--<a href="#countermeasures" id="countermeasures">Countermeasures</a>-->
    <!-- <a href="#about">About</a>-->
  </div>
  <div class="restofbody">
    <div class="row">
      <div class="columngraph1">
        <!--<svg style="width:100%;height:800px" id="svg1"></svg>-->
        <svg width="1400" height="800" id="svg1"></svg>
      </div>
      <div class="columngraph2">
        <input type="submit" name="submit" class="download" id="download" value="Download graph">
      </div>
    </div>
    <div class="row">
      <div class="columngraph1">
        <!--<svg style="width:100%;height:100%;" id="svg2"></svg>-->
        <svg width="1400" height="800" id="svg2"></svg>
      </div>
      <div class="columngraph2">
        <input type="submit" name="submit" class="download" id="downloadcounter" value="Download graph">
      </div>
    </div>
  </div>
  
</body>


<input type="hidden" id="your-hidden-address" value="replace-me" />
<input type="hidden" id="your-hidden-protocol" value="replace-me" />
<input type="hidden" id="your-hidden-port" value="replace-me" />
<input type="hidden" id="your-hidden-severity" value="replace-me" />
<input type="hidden" id="your-hidden-addresssource" value="replace-me" />
<input type="hidden" id="your-hidden-protocolsource" value="replace-me" />
<input type="hidden" id="your-hidden-portsource" value="replace-me" />
<input type="hidden" id="your-hidden-timestamp" value="replace-me" />
<input type="hidden" id="your-hidden-jsonlist" value="replace-me" />
<input type="hidden" id="your-hidden-jsonobj" value="replace-me" />

<link href="styles/style.css" rel="stylesheet">
<!--<script src="https://d3js.org/d3.v4.min.js" type="text/javascript"></script>-->
<script src="scriptjs/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-selection-multi.v1.js"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.3.min.js" ></script>
<script src="scriptjs/demo.js"></script>
<script src="scriptjs/countermeasures.js"></script>
<script src="scriptjs/callajax.js"></script>
<script src="scriptjs/graph.js"></script>
<script src="scriptjs/jsonlist.js"></script>
<!--<script src="scriptjs/alertskafka.js"></script>-->
<!--<script src="scriptjs/executeshellkafka.js"></script>-->
<script>
 
// nom du fichier qui sera qui sera généré par le serveur php

var jsonfile="mulval_generated_json.json";

// conversion du fichier AttackGraph généré par mulval en Objet Json
//jsonfinal=convertxmltojson("scriptphp/AttackGraph.xml");
convertxmltojson("scriptphp/AttackGraph.xml");
//console.log(JSON.stringify(localStorage.getItem('graph'),null,4));
//console.log(localStorage.getItem('notification')); 
if(localStorage.getItem('notification')=="true"){
  //console.log(localStorage.getItem('notification'));  
  //localStorage.setItem('myjson',JSON.stringify(jsonfinal,null,4));
        
  //jsonobj={"json":JSON.stringify(jsonfinal,null,4)};
  jsonobj=JSON.stringify(localStorage.getItem('myjson'),null,4)

  /* transfert du resultat de la convertion au serveur PHP pour l'écriture
  dans un fichier json "mulval_generated_json.json" qui sera utilisé comme paramètre de la fonction generategraph
  */
  $.ajax({
    url:"scriptphp/mulval.php",
    data:jsonobj,
    datatype:"json",
    type:"POST",
    async:true,
    success: function(response){
      // après la creation du fichier JSON en php on génère le Graph
      //console.log(jsonobj);
      //console.log(jsonfinal);
      generateGraph(jsonfile); 
      createContermeasureGraph();
      localStorage.setItem('notification', false);
      
    },
    failure:function(response){
    }
  });
}
else{
  generateGraph(jsonfile); 
  updateGraph();
  createContermeasureGraph();
  
}

</script>
